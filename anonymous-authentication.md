# Summary of TruSTAR’s Anonymous Authentication
 
One of the fundamentally important aspects of the TruSTAR system is that it enables verifiably anonymous authentication. We can break this into three component parts, which correspond with the three words in its name:
 
1. Authentication – Only registered users are able to log in.  Unregistered users cannot.
2. Anonymity – Other than knowing that a user logging in is registered, the system cannot determine which registered user is accessing it.
3. Provability – The system can provide, with mathematical certainty, a proof to the user that it does not know which registered user he is.
 
Each of these components is critical to keeping TruSTAR a safe place for collaboration.  If non-registered users could log in, they could pollute our analytics with false reports.  If users were not anonymous, the server could leak to the public or competitors valuable proprietary data.  Without provability, uncertainty would result in less willingness to share data among the various customers.
 
How do we achieve this?  TruSTAR’s anonymous authentication is based on a specialized implementation of Andrew Lindell’s scheme presented in his paper Anonymous Authentication, which was presented at Black Hat in 2007.
 
Verifiably anonymous authentication is made possible by having the client log in using a special challenge/response protocol.  The server provides a challenge to the client software.  A correct response to the challenge is possible by any of the legitimate users but not by an illegitimate one.  Upon a successful response to the challenge, but before the client sends any sensitive data, the server sends a mathematically verifiable proof that it did not cheat, and cannot tell who the user is.  The client is able to check the correctness of the proof before sending any sensitive data. 
 
While the exact techniques used to accomplish this involve crypto-mathematics, they can be summarized with just a little bit of technical detail by the steps below.
 
1. The client issues a log in request to the server.
2. The server generates k+1 random numbers, where k is the count of all of the registered TruSTAR clients.  The first k numbers are called the “coins.”  There is one coin for each registered client.  One additional number called the “challenge” is also generated.  The challenge must be a big enough number that is very unlikely to be guessed randomly.
3. For each registered user of TruSTAR, the server appends the challenge to that user’s coin and encrypts this with that user’s public key.  The server now has k ciphertexts, one for each possible user.
4. The server sends ALL the ciphertexts to the client that is trying to log in.  This is important.  The server doesn’t know which client is trying to log in, so he must send all them all.  We refer to this set of k ciphertexts as the “packet”.
5. The client, upon receiving the packet, picks the ciphertext out of the list that corresponds to him.  He uses his own private key to decrypt it.  He is now in possession of the challenge and his coin.  The client holds onto the packet to use in a later step.
6. The client uses the TruSTAR server’s public key to encrypt only the challenge number and send it back to the server.  It is important that he only send the challenge and not his coin.  The challenge was the same for each public key, but the coin was not.  Sending back the coin would reveal to the server who he is, but sending the challenge doesn’t.
7. Upon receiving and decrypting the challenge number, the server compares it to the one it originally sent.  If they are equal, the server knows that whoever sent it had a private key that corresponds to one of the public keys of the registered users, though he does not know which one.  This means that the client is an authentic user, but is anonymous. If not, the user is illegitimate, and the server hangs up.
8. The client still doesn’t know that the server didn’t cheat.  (A dishonest server could have generated a different challenge for each key instead of a single challenge, as he was supposed to. Then by checking which challenge he got back, he could break anonymity.)  To demonstrate that he didn’t cheat, the server sends the original list of all of the coins in the clear, but digitally signed to avoid tampering.  These plaintext coins will serve the role of the proof of anonymity in the next step.
9. Upon receiving the coins, the client verifies the server’s digital signature.  If it checks, then he appends each coin in turn to the challenge that he discovered in step 5. He encrypts each of these with the public key for the user that corresponds to the coin.  (These keys are really public.)  He compares each ciphertext that he generates to the corresponding one in the packet that he also saved in step 5. If they all match, it means that the server really did use a single challenge number and didn’t cheat by generating a different one for different users.  If they don’t all match, something has gone wrong and the client disconnects without sending any sensitive data.  The coins act as a proof of anonymity, and the act of re-encrypting them and checking them against the packets serves as a verification of that proof. 
10. The server and client destroy their copies of the challenge, the packet and all the coins.  They will not be used again, as new ones are generated for each log in attempt.
 
Of course there are important implementation details about how the TruSTAR system manages the keys.  It is important that there be a registry of all valid public keys to the system that cannot be altered by an attacker.  If one were to somehow break through and alter the public key registry, he could allow himself access to submit data without paying for the TruSTAR service, or he could deny a paying customer access for a short time.  But, because of our verifiable proof mechanic, the one thing that an attacker cannot do regardless of a breach of the key store is break anonymity. We believe with an implementation of a proper, and well-vetted PKI infrastructure, TruSTAR will not be subject to any of these attack vectors.

Even better, because of our verifiable proof mechanic, the one thing that an attacker cannot do regardless of a breach of the key store is break anonymity. 
